<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ - –¶–≤–µ—Ç–æ—á–Ω—ã–π –†–∞–π</title>
    
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="theme.css">
    <link rel="stylesheet" href="pages.css">
    
    <style>
        .email-dashboard {
            padding: 2rem 0;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .email-section {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .email-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .email-table {
            width: 100%;
            border-collapse: collapse;
        }

        .email-table th {
            text-align: left;
            padding: 1rem;
            background: var(--bg-alt);
            border-bottom: 2px solid var(--border-color);
        }

        .email-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .email-preview-btn {
            padding: 0.5rem 1rem;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .email-status {
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .email-status-sent {
            background: #d4edda;
            color: #155724;
        }

        .email-status-queued {
            background: #fff3cd;
            color: #856404;
        }

        .email-status-failed {
            background: #f8d7da;
            color: #721c24;
        }

        .create-campaign-form {
            display: grid;
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text-primary);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        @media (max-width: 768px) {
            .dashboard-stats {
                grid-template-columns: 1fr;
            }

            .email-table {
                font-size: 0.9rem;
            }

            .email-table th,
            .email-table td {
                padding: 0.75rem 0.5rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <span class="logo-icon">üå∏</span>
                <span class="logo-text">–¶–≤–µ—Ç–æ—á–Ω—ã–π –†–∞–π</span>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="index.html#catalog">–ö–∞—Ç–∞–ª–æ–≥</a></li>
                <li><a href="blog.html">–ë–ª–æ–≥</a></li>
                <li><a href="email-dashboard.html" class="active">Email –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥</a></li>
            </ul>
            <div class="header-icons">
                <button class="icon-btn theme-toggle" onclick="toggleTheme()" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">
                    <span class="theme-icon">üåô</span>
                </button>
            </div>
        </nav>
    </header>

    <section class="email-dashboard">
        <div class="container">
            <h1 class="page-title">üìß Email –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥</h1>
            <p class="page-description">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ email-–∫–∞–º–ø–∞–Ω–∏—è–º–∏ –∏ —Ä–∞—Å—Å—ã–ª–∫–∞–º–∏</p>

            <!-- Statistics -->
            <div class="dashboard-stats" id="email-stats">
                <!-- Stats will be loaded by JavaScript -->
            </div>

            <!-- Email Queue -->
            <div class="email-section">
                <div class="email-section-header">
                    <h2>üì® –û—á–µ—Ä–µ–¥—å –æ—Ç–ø—Ä–∞–≤–∫–∏</h2>
                    <button class="btn-primary" onclick="processQueueManually()">–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—á–µ—Ä–µ–¥—å</button>
                </div>
                <div style="overflow-x: auto;">
                    <table class="email-table" id="email-queue-table">
                        <thead>
                            <tr>
                                <th>–ü–æ–ª—É—á–∞—Ç–µ–ª—å</th>
                                <th>–¢–µ–º–∞</th>
                                <th>–¢–∏–ø</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–∞—Ç–∞</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Queue items will be loaded by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Email Campaigns -->
            <div class="email-section">
                <div class="email-section-header">
                    <h2>üìä –ò—Å—Ç–æ—Ä–∏—è –∫–∞–º–ø–∞–Ω–∏–π</h2>
                    <button class="btn-secondary" onclick="showCreateCampaignForm()">+ –°–æ–∑–¥–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏—é</button>
                </div>
                <div style="overflow-x: auto;">
                    <table class="email-table" id="campaigns-table">
                        <thead>
                            <tr>
                                <th>–¢–∏–ø</th>
                                <th>–¢–µ–º–∞</th>
                                <th>–ü–æ–ª—É—á–∞—Ç–µ–ª–µ–π</th>
                                <th>–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Campaigns will be loaded by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Subscribers List -->
            <div class="email-section">
                <div class="email-section-header">
                    <h2>üë• –ü–æ–¥–ø–∏—Å—á–∏–∫–∏</h2>
                    <button class="btn-secondary" onclick="exportSubscribers()">üì• –≠–∫—Å–ø–æ—Ä—Ç</button>
                </div>
                <div style="overflow-x: auto;">
                    <table class="email-table" id="subscribers-table">
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>–ò–º—è</th>
                                <th>–î–∞—Ç–∞ –ø–æ–¥–ø–∏—Å–∫–∏</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–ò—Å—Ç–æ—á–Ω–∏–∫</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Subscribers will be loaded by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Email Previews -->
            <div class="email-section">
                <div class="email-section-header">
                    <h2>üëÅÔ∏è –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–∏—Å—å–º–∞</h2>
                </div>
                <div style="overflow-x: auto;">
                    <table class="email-table" id="previews-table">
                        <thead>
                            <tr>
                                <th>–ü–æ–ª—É—á–∞—Ç–µ–ª—å</th>
                                <th>–¢–µ–º–∞</th>
                                <th>–¢–∏–ø</th>
                                <th>–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Previews will be loaded by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <!-- Create Campaign Modal -->
    <div id="create-campaign-modal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <button class="modal-close" onclick="closeCreateCampaignForm()">‚úï</button>
            <h2>–°–æ–∑–¥–∞—Ç—å email-–∫–∞–º–ø–∞–Ω–∏—é</h2>
            <form class="create-campaign-form" onsubmit="return createNewCampaign(event)">
                <div class="form-group">
                    <label>–¢–∏–ø –∫–∞–º–ø–∞–Ω–∏–∏</label>
                    <select id="campaign-type" required>
                        <option value="newsletter">Newsletter</option>
                        <option value="promo">–ü—Ä–æ–º–æ-–∞–∫—Ü–∏—è</option>
                        <option value="announcement">–û–±—ä—è–≤–ª–µ–Ω–∏–µ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–¢–µ–º–∞ –ø–∏—Å—å–º–∞</label>
                    <input type="text" id="campaign-subject" required placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –ø–∏—Å—å–º–∞">
                </div>
                <div class="form-group">
                    <label>–ú–µ—Å—è—Ü (–¥–ª—è newsletter)</label>
                    <input type="text" id="campaign-month" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –Ø–Ω–≤–∞—Ä—å 2026">
                </div>
                <div class="form-group">
                    <label>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</label>
                    <select id="campaign-recipients">
                        <option value="all">–í—Å–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º</option>
                        <option value="active">–¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</option>
                        <option value="inactive">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary" style="width: 100%;">–°–æ–∑–¥–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </form>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>–û –Ω–∞—Å</h3>
                <p>–¶–≤–µ—Ç–æ—á–Ω—ã–π –†–∞–π - –≤–∞—à –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä—Ç–Ω–µ—Ä –≤ –º–∏—Ä–µ —Ü–≤–µ—Ç–æ–≤</p>
            </div>
            <div class="footer-section">
                <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                <p>Email: info@flowerparadise.ru</p>
                <p>–¢–µ–ª–µ—Ñ–æ–Ω: +7 (999) 123-45-67</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 –¶–≤–µ—Ç–æ—á–Ω—ã–π –†–∞–π. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </div>
    </footer>

    <script src="script.js"></script>
    <script src="theme.js"></script>
    <script src="email-templates.js"></script>
    <script src="email.js"></script>

    <script>
        // Load dashboard data
        document.addEventListener('DOMContentLoaded', () => {
            loadEmailStats();
            loadEmailQueue();
            loadCampaigns();
            loadSubscribers();
            loadEmailPreviews();

            // Refresh data every 30 seconds
            setInterval(() => {
                loadEmailStats();
                loadEmailQueue();
            }, 30000);
        });

        function loadEmailStats() {
            const stats = window.EmailAPI.getEmailStatistics();
            document.getElementById('email-stats').innerHTML = `
                <div class="stat-card">
                    <div class="stat-icon">üìß</div>
                    <div class="stat-value">${stats.totalCampaigns}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –∫–∞–º–ø–∞–Ω–∏–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-value">${stats.sentEmails}</div>
                    <div class="stat-label">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–∏—Å–µ–º</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚è≥</div>
                    <div class="stat-value">${stats.queuedEmails}</div>
                    <div class="stat-label">–í –æ—á–µ—Ä–µ–¥–∏</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-value">${stats.activeSubscribers}</div>
                    <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</div>
                </div>
            `;
        }

        function loadEmailQueue() {
            const queue = window.EmailAPI.getQueue();
            const tbody = document.querySelector('#email-queue-table tbody');
            
            if (queue.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem; color: var(--text-secondary);">–û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞</td></tr>';
                return;
            }

            tbody.innerHTML = queue.slice(0, 10).map(email => `
                <tr>
                    <td>${email.to}</td>
                    <td>${email.subject}</td>
                    <td>${email.type}</td>
                    <td><span class="email-status email-status-${email.status}">${getStatusText(email.status)}</span></td>
                    <td>${formatDate(email.queuedAt)}</td>
                    <td><button class="email-preview-btn" onclick="window.EmailAPI.viewEmailPreview('${email.id}')">–ü—Ä–æ—Å–º–æ—Ç—Ä</button></td>
                </tr>
            `).join('');
        }

        function loadCampaigns() {
            const campaigns = window.EmailAPI.getCampaigns();
            const tbody = document.querySelector('#campaigns-table tbody');
            
            if (campaigns.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 2rem; color: var(--text-secondary);">–ù–µ—Ç –∫–∞–º–ø–∞–Ω–∏–π</td></tr>';
                return;
            }

            tbody.innerHTML = campaigns.slice(0, 10).map(campaign => `
                <tr>
                    <td>${campaign.type}</td>
                    <td>${campaign.subject}</td>
                    <td>${campaign.recipientsCount}</td>
                    <td>${formatDate(campaign.sentAt)}</td>
                    <td><span class="email-status email-status-${campaign.status}">${getStatusText(campaign.status)}</span></td>
                </tr>
            `).join('');
        }

        function loadSubscribers() {
            const subscribers = window.EmailAPI.getSubscribers();
            const tbody = document.querySelector('#subscribers-table tbody');
            
            if (subscribers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 2rem; color: var(--text-secondary);">–ù–µ—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</td></tr>';
                return;
            }

            tbody.innerHTML = subscribers.slice(0, 20).map(sub => `
                <tr>
                    <td>${sub.email}</td>
                    <td>${sub.name || '-'}</td>
                    <td>${formatDate(sub.subscribedAt)}</td>
                    <td><span class="email-status email-status-${sub.subscribed ? 'sent' : 'failed'}">${sub.subscribed ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–û—Ç–ø–∏—Å–∞–Ω'}</span></td>
                    <td>${sub.source || 'N/A'}</td>
                </tr>
            `).join('');
        }

        function loadEmailPreviews() {
            const previews = JSON.parse(localStorage.getItem('emailPreviews') || '[]');
            const tbody = document.querySelector('#previews-table tbody');
            
            if (previews.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 2rem; color: var(--text-secondary);">–ù–µ—Ç –ø–∏—Å–µ–º</td></tr>';
                return;
            }

            tbody.innerHTML = previews.slice(0, 10).map(preview => `
                <tr>
                    <td>${preview.to}</td>
                    <td>${preview.subject}</td>
                    <td>${preview.type}</td>
                    <td>${formatDate(preview.sentAt)}</td>
                    <td><button class="email-preview-btn" onclick="window.EmailAPI.viewEmailPreview('${preview.id}')">–ü—Ä–æ—Å–º–æ—Ç—Ä</button></td>
                </tr>
            `).join('');
        }

        function showCreateCampaignForm() {
            document.getElementById('create-campaign-modal').classList.add('active');
        }

        function closeCreateCampaignForm() {
            document.getElementById('create-campaign-modal').classList.remove('active');
        }

        function createNewCampaign(event) {
            event.preventDefault();

            const type = document.getElementById('campaign-type').value;
            const subject = document.getElementById('campaign-subject').value;
            const month = document.getElementById('campaign-month').value;
            const recipients = document.getElementById('campaign-recipients').value;

            // Get subscribers based on selection
            const allSubscribers = window.EmailAPI.getSubscribers();
            let recipientsList = allSubscribers.filter(s => s.subscribed);

            // Create newsletter data
            const newsletterData = {
                campaignId: 'campaign_' + Date.now(),
                month: month || '–Ø–Ω–≤–∞—Ä—å 2026',
                articles: [
                    {
                        id: 1,
                        emoji: 'üåπ',
                        title: '–ö–∞–∫ —É—Ö–∞–∂–∏–≤–∞—Ç—å –∑–∞ —Ä–æ–∑–∞–º–∏',
                        excerpt: '–£–∑–Ω–∞–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–≤–µ–∂–µ—Å—Ç–∏ —Ä–æ–∑'
                    }
                ]
            };

            window.EmailAPI.sendNewsletter(newsletterData, recipientsList);

            showNotification(`–ö–∞–º–ø–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∞! –ü–∏—Å—å–º–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã ${recipientsList.length} –ø–æ–ª—É—á–∞—Ç–µ–ª—è–º.`);
            closeCreateCampaignForm();
            
            // Reload data
            setTimeout(() => {
                loadEmailStats();
                loadCampaigns();
            }, 1000);

            return false;
        }

        function processQueueManually() {
            showNotification('–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏...');
            // Process queue is automatically handled by email.js
            setTimeout(() => {
                loadEmailStats();
                loadEmailQueue();
                showNotification('–û—á–µ—Ä–µ–¥—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞!');
            }, 1000);
        }

        function exportSubscribers() {
            const subscribers = window.EmailAPI.getSubscribers();
            const csv = 'Email,Name,Subscribed At,Status\n' + 
                subscribers.map(s => `${s.email},${s.name || ''},${formatDate(s.subscribedAt)},${s.subscribed ? 'Active' : 'Unsubscribed'}`).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'subscribers_' + Date.now() + '.csv';
            a.click();
            
            showNotification('–ü–æ–¥–ø–∏—Å—á–∏–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ CSV!');
        }

        function getStatusText(status) {
            const statusMap = {
                'queued': '–í –æ—á–µ—Ä–µ–¥–∏',
                'sent': '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ',
                'failed': '–û—à–∏–±–∫–∞'
            };
            return statusMap[status] || status;
        }

        function formatDate(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('ru-RU');
        }
    </script>
</body>
</html>
